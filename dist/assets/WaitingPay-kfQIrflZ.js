import{c as j,d as A,r as x,j as e,Q as D,m as E}from"./index-PgkcB_MP.js";import{m as p}from"./medicinePrescriptionService-9qaIjgXA.js";const m="http://14.225.205.182:8087/api/bill/",F={getAllBills:async()=>j.get(m).then(c=>c.data).catch(c=>{console.log(c)}),createBill:async c=>j.post(m,c).then(a=>a.data).catch(a=>{console.log(a)}),editBill:async(c,a)=>j.put(m+"/"+a,c).then(h=>h.data).catch(h=>{console.log(h)}),deleteBill:async c=>j.delete(m+"/"+c).then(a=>a.data).catch(a=>{console.log(a)}),getBillById:async c=>j.get(m+"/"+c).then(a=>a.data).catch(a=>{console.log(a)})};function U(){const c=A(),[a,h]=x.useState([]),[u,T]=x.useState([]),[t,C]=x.useState(null),[I,B]=x.useState(!0),[s,M]=x.useState({id:"",fullName:"",eyeCategoryId:"",phoneNumber:"",dateBooking:"",timeBooking:"",idsMedicine:""}),[R,L]=x.useState({idPrescription:"",idReceptionist:"",idBooking:"",totalPrice:""}),y=async()=>{try{const r=(await p.getMdicinePrescription()).content;h(r),B(!1)}catch(n){console.log(n)}},z=async n=>{try{M(n);const r=await p.getPrescriptionByIdBooking(n.id),i=await p.getShowDetailPrescription(r);C(i)}catch(r){console.log(r)}};x.useEffect(()=>{console.log(t)},[t]);const V=async n=>{const r={idPrescription:n.id,idReceptionist:n.doctor.id,idBooking:n.idBooking,totalPrice:n.totalAmount};try{const i=await F.createBill(r);console.log("Bill saved successfully:",i),D.success("Đã thanh toán hóa đơn!",{position:D.POSITION.TOP_RIGHT});const o=u.map(d=>d.id===n.idBooking?{...d,status:"UNPAID"}:d);L(r),await y(),$(`#modal-${n.idBooking}`).modal("hide"),$(".modal-backdrop").css("display","none")}catch(i){console.error("Error saving bill:",i)}};x.useEffect(()=>{y()},[]),x.useEffect(()=>{(async()=>{try{const i=(await Promise.all(a.map(async o=>{if(o.idBooking){const d=o.idBooking;return await E.getBookingById(d)}return null}))).filter(o=>o!==null&&o.status==="UNPAID");T(i)}catch(r){console.log(r)}})()},[a]);const k=n=>{const r=new Date(n),i=r.getDate(),o=r.getMonth()+1,d=r.getFullYear();return`${i} tháng ${String(o).padStart(2,"0")} năm ${d}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{children:e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsx("h5",{className:"card-title fw-semibold mb-4",children:"Danh sách chờ thanh toán"})})}),I?e.jsx("span",{className:"loader"}):e.jsxs("div",{className:"card w-100",children:[e.jsxs("div",{className:"d-flex ps-4 pt-4",children:[e.jsx("span",{className:"h5 fw-semibold",children:a.length}),e.jsx("p",{className:"ms-1 fw-normal",children:"hóa đơn"})]}),e.jsxs("div",{className:"card-body p-4",children:[u.length?e.jsxs("table",{className:"table text-nowrap mb-0 align-middle",children:[e.jsx("thead",{className:"text-dark fs-3",children:e.jsxs("tr",{className:"text-center",children:[e.jsx("th",{children:"STT"}),e.jsx("th",{children:"Họ và tên"}),e.jsx("th",{children:"Số điện thoại"}),e.jsx("th",{children:"Ngày khám"}),e.jsx("th",{children:"Chi tiết hóa đơn"})]})}),e.jsx("tbody",{children:u.map((n,r)=>{const i=r+1;return e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{children:i}),e.jsx("td",{children:n.customer.user.fullName}),e.jsx("td",{children:n.customer.user.phoneNumber}),e.jsx("td",{children:n.dateBooking}),e.jsx("td",{children:e.jsx("div",{className:"d-flex align-items-center justify-content-center",children:e.jsx("button",{className:"btn btn-outline-info d-flex align-items-center justify-content-center",style:{width:"36px",height:"36px"},type:"button","data-toggle":"modal","data-target":`#modal-${n.id}`,onClick:()=>z(n),children:e.jsx("i",{className:"ti ti-wallet",style:{fontSize:"18px"}})})})})]},n.id)})})]}):e.jsx("div",{className:"m-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-4",style:{flexDirection:"column"},children:[e.jsx("div",{children:e.jsx("i",{class:"fa-regular fa-calendar-xmark text-danger",style:{fontSize:"124px"}})}),e.jsx("span",{className:"fw-semibold",style:{fontSize:"32px"},children:"Danh sách hôm nay đang trống!"})]})}),u.map((n,r)=>{var i,o,d,g,f,N,b,v,S;return e.jsx("div",{className:"modal-frame",children:e.jsx("div",{className:"modal fade",id:`modal-${n.id}`,tabIndex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:e.jsx("div",{class:"modal-content",children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{class:"d-flex align-items-center row",children:[e.jsx("div",{class:"col-3 d-flex align-items-center justify-content-start",children:e.jsx("div",{class:"logo-container mt-4",style:{marginLeft:"20px",marginTop:"200px"},children:e.jsx("img",{src:"../../images/logo2.png",alt:"",class:"logo",style:{width:"240px"}})})}),e.jsx("div",{className:"col-6 flex justify-between",children:e.jsxs("div",{className:"flex flex-col justify-center items-center",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginLeft:"20px",marginTop:"20px",marginRight:"20px"},children:[e.jsx("h1",{className:"",style:{fontSize:"36px"},children:"Phòng khám mắt Văn Minh"}),e.jsx("h1",{className:"",style:{fontSize:"20px"},children:"28 Lê Lợi - TP.Huế"}),e.jsx("h1",{className:"",style:{fontSize:"20px"},children:"ĐT: 0836.092.222"}),e.jsxs("h1",{className:"",style:{fontSize:"24px",fontWeight:"bolder"},children:["Mã BN: ",(o=(i=s==null?void 0:s.customer)==null?void 0:i.user)==null?void 0:o.phoneNumber]})]})}),e.jsx("div",{className:"col-3",style:{marginTop:"50px"},children:e.jsxs("div",{className:"d-flex align-items-center justify-content-around row mb-4",children:[e.jsx("div",{className:"col-5 d-flex align-items-center justify-content-center",children:e.jsx("h5",{children:"T2 - CN:"})}),e.jsxs("div",{className:"d-flex align-items-center justify-content-end col-7 gap-2",style:{flexDirection:"column"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-0",children:e.jsx("p",{className:"mb-0",children:"08:00-12:00"})}),e.jsx("div",{className:"d-flex align-items-center justify-content-center",children:e.jsx("p",{className:"mb-0",children:"14:00-18:00"})})]})]})})]}),e.jsxs("div",{class:"modal-body",children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{className:"fw-bolder",style:{fontSize:"44px"},children:"ĐƠN THUỐC"})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-9 mt-8 row",children:[e.jsx("strong",{className:"col-4",children:"Họ và tên: "}),e.jsx("span",{className:"col-8 d-flex justify-content-start ",children:(g=(d=s==null?void 0:s.customer)==null?void 0:d.user)==null?void 0:g.fullName})]}),e.jsxs("div",{className:"col-3 mt-8 d-flex justify-content-end row",children:[e.jsx("strong",{className:"col-6",children:"Năm sinh:"}),e.jsx("span",{className:"d-flex justify-content-center col-6",children:(f=s==null?void 0:s.customer)==null?void 0:f.age})]})]}),e.jsxs("div",{class:"mt-8 d-flex align-items-center row",children:[e.jsx("strong",{className:"col-2",children:"Chẩn đoán:"}),e.jsx("span",{className:"d-flex justify-content-center col-10",children:t==null?void 0:t.diagnose})]}),e.jsxs("div",{class:"mt-8 row d-flex",children:[e.jsx("strong",{className:"col-2",children:"Bệnh phụ: "}),e.jsxs("span",{className:"d-flex justify-content-center align-items-center col-10",children:[t!=null&&t.note.split(",")[1]?t==null?void 0:t.note.split(",")[1]:"",t!=null&&t.note.split(",")[2]?", "+(t==null?void 0:t.note.split(",")[2])+", ":"",t!=null&&t.note.split(",")[3]?t==null?void 0:t.note.split(",")[3]:""]})]}),e.jsxs("div",{class:"mt-8 row d-flex",style:{marginBottom:"30px"},children:[e.jsx("strong",{className:"col-2",children:"Ghi chú: "}),e.jsx("span",{className:"d-flex justify-content-center align-items-center col-10",children:(t==null?void 0:t.note.split(",")[0])||""})]}),e.jsx("div",{class:"mt-8",style:{marginBottom:"30px"},children:e.jsxs("table",{class:"border-collapse",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center"}),e.jsx("th",{class:"border p-2 text-center",children:"Thị lực"}),e.jsx("th",{class:"border p-2 text-center",children:"Mắt phải"}),e.jsx("th",{class:"border p-2 text-center",children:"Mắt trái"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:"MP"}),e.jsx("td",{class:"border p-2 text-center",children:t!=null&&t.eyeSight?t.eyeSight[0]+"/10":null}),e.jsx("td",{rowSpan:3,className:"border p-2 text-center",children:e.jsx("i",{class:"fa-solid fa-eye",style:{fontSize:"60px"}})}),e.jsx("td",{rowSpan:3,className:"border p-2 text-center",children:e.jsx("i",{class:"fa-solid fa-eye",style:{fontSize:"60px"}})})]}),e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:"MT"}),e.jsx("td",{class:"border p-2 text-center",children:t!=null&&t.eyeSight?t.eyeSight[3]+"/10":null})]}),e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:"Khác"}),e.jsx("td",{class:"border p-2 text-center"})]})]})]})}),e.jsx("div",{class:"mt-8",children:e.jsxs("table",{class:" mt-8 border-collapse",style:{width:"100%"},children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center"}),e.jsx("th",{colSpan:4,class:"border p-2 text-center",children:"Dịch vụ"}),e.jsx("th",{class:"border p-2 text-center",children:"Giá dịch vụ"})]}),e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center"}),s!=null&&s.eyeCategory?e.jsxs(e.Fragment,{children:[e.jsx("td",{colSpan:4,className:"border p-2 text-center",children:(N=s==null?void 0:s.eyeCategory)==null?void 0:N.nameCategory}),e.jsx("td",{className:"border p-2 text-center",children:(b=s==null?void 0:s.eyeCategory)==null?void 0:b.price.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})})]}):null]}),e.jsxs("tr",{children:[e.jsx("th",{class:"border p-2 text-center",children:"STT"}),e.jsx("th",{class:"border p-2 text-center",children:"Tên thuốc"}),e.jsx("th",{class:"border p-2 text-center",children:"Đơn vị"}),e.jsx("th",{class:"border p-2 text-center",children:"Số lượng"}),e.jsx("th",{class:"border p-2 text-center",children:"Đơn giá"}),e.jsx("th",{class:"border p-2 text-center",children:"Thành tiền"})]})]}),e.jsxs("tbody",{children:[t!=null&&t.medicines&&t.medicines.length>0?t.medicines.map((l,w)=>e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center",children:w+(s!=null&&s.eyeCategories?s.eyeCategories.length:0)+(s!=null&&s.eyeCategory?1:0)}),e.jsx("td",{class:"border p-2 text-center",children:e.jsxs("div",{className:"d-flex justify-content-center align-items-center",children:[e.jsx("div",{children:l==null?void 0:l.nameMedicine}),e.jsx("div",{style:{fontSize:"13px"},children:e.jsxs("em",{children:[" ( ",l==null?void 0:l.useMedicine," - ",l==null?void 0:l.noteMedicine," )"]})})]})}),e.jsx("td",{class:"border p-2 text-center",children:(l==null?void 0:l.type)==="PELLET"?"Viên":"Chai"}),e.jsx("td",{class:"border p-2 text-center",children:l==null?void 0:l.quantity}),e.jsx("td",{class:"border p-2 text-center",children:l==null?void 0:l.priceMedicine.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})}),e.jsx("td",{class:"border p-2 text-center",children:((l==null?void 0:l.priceMedicine)*(l==null?void 0:l.quantity)).toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})})]},w+(s!=null&&s.eyeCategories?s.eyeCategories.length:0)+(s!=null&&s.eyeCategory?2:1))})):null,e.jsxs("tr",{children:[e.jsx("td",{class:"border p-2 text-center"}),e.jsx("th",{colSpan:4,class:"border p-2 text-center",children:"Tổng tiền:"}),e.jsx("td",{class:"border p-2 text-danger text-center fw-bolder",children:t==null?void 0:t.totalAmount.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})})]})]})]})}),e.jsx("div",{class:"mt-4",children:e.jsxs("strong",{children:["Ngày khám: ",e.jsxs("span",{className:"fw-normal",children:[" ",k(s==null?void 0:s.dateBooking)]})]})}),e.jsxs("div",{className:"row mt-2 d-flex align-items-center",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-end",style:{flexDirection:"column"},children:[e.jsx("strong",{children:"Người thu tiền"}),e.jsx("p",{className:"mt-5",children:(v=c==null?void 0:c.user)==null?void 0:v.fullName})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-end",style:{flexDirection:"column"},children:[e.jsx("strong",{children:"Bác sĩ khám bệnh"}),e.jsxs("p",{className:"mt-5",children:["ThS BS ",(S=t==null?void 0:t.doctor)==null?void 0:S.name]})]})})]})]}),e.jsxs("div",{class:"modal-footer",children:[e.jsx("button",{id:"close-save",class:"btn btn-primary mr-2",type:"button",onClick:()=>V(t),children:"Xác nhận"}),e.jsx("button",{id:"close-button",type:"button",class:"btn btn-danger mr-2","data-dismiss":"modal",children:"Đóng"})]})]})})})})},n.id)})]})]})]})})}export{U as default};
