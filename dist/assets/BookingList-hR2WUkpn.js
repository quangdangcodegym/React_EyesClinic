import{r as s,j as e,m as h,q as F,S as f}from"./index-PgkcB_MP.js";import"./pagination-1_X_7A8j.js";import{U as ce}from"./Socket-To_Q-LFU.js";import{R as re}from"./react-paginate-W8O2EvoL.js";import"./index-OFSkRISh.js";function ke(){const[r,M]=s.useState(""),[i,p]=s.useState({}),[d,g]=s.useState({}),[c,x]=s.useState([]),[T,k]=s.useState([]),[O,H]=s.useState([]),[j,U]=s.useState({}),[D,de]=s.useState(["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"]),[R,ge]=s.useState(["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30"]),[W,me]=s.useState(["14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"]),[$,E]=s.useState([]);s.useState();const[G,X]=s.useState(!0),[C,z]=s.useState(!1),[u,K]=s.useState("all"),V=()=>{const t=new Date,n=t.getFullYear(),a=t.getMonth()+1,o=t.getDate();M(`${n}-${a.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}`)},L=async()=>{const t={idEyeCategory:"",idCustomer:"",timeBooking:"",dateBooking:String(r),status:""},n=await h.getBookingByStatusPendingAndDate(t);x(n),X(!1)},q=async t=>{const n={idEyeCategory:"",idCustomer:"",timeBooking:"",dateBooking:String(t.target.value),status:""},a=await h.getBookingByStatusPendingAndDate(n);x(a)},Y=async t=>{const n=await h.getBookingById(t);p(n),b(n.dateBooking)},b=async t=>{const n={idEyeCategory:"",idCustomer:"",timeBooking:"",dateBooking:String(t),status:""},o=(await h.getBookingByStatusWaitingAndDate(n)).map(y=>y.timeBooking),l=new Date,m=l.getHours(),oe=l.getMinutes(),le=`${m.toString().padStart(2,"0")}:${oe.toString().padStart(2,"0")}`;if(new Date(t)>l){const y=D.filter(B=>!o.includes(B));E(y)}else{const y=D.filter(B=>!o.includes(B)&&B.localeCompare(le)>0);E(y)}},J=async()=>{const t=await F.getAllEyeCategories();H(t)},Q=async t=>{const n=await F.getEyeCategoryById(t.target.value);U(n)},Z=()=>{if(Object.keys(j).length)if(Object.keys(d).length){const t={...d,eyeCategory:{id:j.id}};g(t)}else{const t={...i,eyeCategory:{id:j.id}};g(t)}},N=async t=>{if(Object.keys(d).length)if(t.target.name=="dateBooking"){const n=t.target.value;b(n);const a={...d,[t.target.name]:t.target.value};g(a)}else{const n={...d,[t.target.name]:t.target.value};g(n)}else if(t.target.name=="dateBooking"){const n=t.target.value;b(n);const a={...i,[t.target.name]:t.target.value};g(a)}else{const n={...i,[t.target.name]:t.target.value};g(n)}},_=async()=>{console.log(d),await v(d),f.fire({position:"center",icon:"success",title:"Cập Nhật Thành Công !",showConfirmButton:!1,timer:1500})},v=async t=>{const n={idEyeCategory:String(t.eyeCategory.id),idCustomer:String(t.customer.id),timeBooking:t.timeBooking,dateBooking:t.dateBooking,status:t.status,message:t.message},a=await h.editBooking(n,t.id),o=c.findIndex(m=>m.id===t.id),l=[...c];l[o]=a,x(l),p({}),g({})},ee=t=>{f.fire({title:"Bạn chắc chắn muốn hủy lịch hẹn khám này chứ?",showCancelButton:!0,confirmButtonText:"Hủy",cancelButtonText:"Không"}).then(async n=>{if(n.isConfirmed){const o={...await h.getBookingById(t),status:"CANCELLED"};await v(o),f.fire("Hủy thành công!","","success"),x(l=>l.filter(m=>m.id!==t))}})},te=async t=>{f.fire({title:"Xác nhận khám lịch hẹn này?",showCancelButton:!0,confirmButtonText:"Có",cancelButtonText:"Không"}).then(async n=>{if(n.isConfirmed){const o={...await h.getBookingById(t),status:"WAITING"};await v(o),f.fire({position:"center",icon:"success",title:"Xác Nhận Thành Công !",showConfirmButton:!1,timer:1500}),x(l=>l.filter(m=>m.id!==t))}})},A=()=>{p({})},S=t=>{K(t),t==="all"?k(c):t==="morning"?k(c.filter(n=>R.includes(n.timeBooking))):t==="afternoon"&&k(c.filter(n=>W.includes(n.timeBooking)))};s.useEffect(()=>{k(c)},[c]),s.useEffect(()=>{Z()},[j]),s.useEffect(()=>{J(),V(),ce(z,C)},[]),s.useEffect(()=>{r&&(L(),console.log(C))},[C]),s.useEffect(()=>{r&&L()},[r]);const[ne,se]=s.useState(0),w=5,ae=t=>{se(t.selected)},P=(ne+1)*w,I=P-w,ie=T.sort((t,n)=>t.timeBooking.localeCompare(n.timeBooking)).slice(I,P);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsx("h5",{className:"card-title fw-semibold mb-4",children:"Danh sách hẹn khám"})}),e.jsx("div",{className:"col-lg-12 d-flex align-items-around",style:{padding:0},children:e.jsxs("div",{className:"card w-100",children:[e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("h6",{className:"mr-3",children:"Chọn ngày: "}),e.jsx("div",{className:"col-7 ",children:e.jsx("input",{type:"date",className:"form-control",defaultValue:r,onChange:q,min:r})})]}),e.jsxs("div",{className:"d-flex align-items-center gap-4",children:[e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>S("all"),style:{backgroundColor:u==="all"?"#007bff":"initial",color:u==="all"?"#fff":"initial"},children:"Tất cả"})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>S("morning"),style:{backgroundColor:u==="morning"?"#007bff":"initial",color:u==="morning"?"#fff":"initial"},children:"Sáng"})}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>S("afternoon"),style:{backgroundColor:u==="afternoon"?"#007bff":"initial",color:u==="afternoon"?"#fff":"initial"},children:"Chiều"})})]})]})}),e.jsx("div",{className:"card-body p-2",children:G?e.jsx("span",{className:"loader"}):T.length?e.jsx(e.Fragment,{children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"thead-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"STT"}),e.jsx("th",{children:"Họ và tên"}),e.jsx("th",{children:"Số điện thoại"}),e.jsx("th",{children:"Ngày khám"}),e.jsx("th",{children:"Giờ khám"}),e.jsx("th",{className:"text-center",children:"Dịch vụ"}),e.jsx("th",{className:"col-4 text-center",children:"Hành động"})]})}),e.jsx("tbody",{children:ie.map((t,n)=>{const a=n+1+I;return e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:a}),e.jsx("td",{children:t.customer.user.fullName}),e.jsx("td",{children:t.customer.user.phoneNumber}),e.jsx("td",{children:t.dateBooking}),e.jsx("td",{className:"text-center",children:t.timeBooking}),e.jsx("td",{className:"text-center",children:t.eyeCategory.nameCategory}),e.jsxs("td",{className:"text-center",children:[e.jsx("button",{className:"btn btn-warning mr-2",type:"button","data-toggle":"modal","data-target":"#exampleModal",onClick:()=>Y(t.id),children:"Sửa"}),e.jsx("button",{className:"btn btn-danger mr-2",onClick:()=>ee(t.id),children:"Hủy"}),e.jsx("button",{className:"btn btn-success",onClick:()=>te(t.id),children:"Xác nhận khám"})]})]},t.id)})})]})}):e.jsx("div",{className:"m-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-4",style:{flexDirection:"column"},children:[e.jsx("div",{children:e.jsx("i",{class:"fa-regular fa-calendar-xmark text-danger",style:{fontSize:"124px"}})}),e.jsx("span",{className:"fw-semibold",style:{fontSize:"32px"},children:"Danh sách hôm nay đang trống!"})]})})})]})}),e.jsx("div",{className:"pagination-container",style:{margin:0,display:"flex",justifyContent:"flex-end"},children:e.jsx(re,{pageCount:Math.ceil(c.length/w),pageRangeDisplayed:5,marginPagesDisplayed:2,onPageChange:ae,containerClassName:"pagination",activeClassName:"active",previousLabel:"Previous",nextLabel:"Next",breakLabel:"..."})})]}),e.jsx("div",{className:"modal fade",id:"exampleModal",tabIndex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title font-weight-bold",id:"exampleModalLabel",children:"Thay đổi thông tin lịch hẹn"}),e.jsx("button",{type:"button",className:"btn-close","data-dismiss":"modal","aria-label":"Close",onClick:A})]}),e.jsx("div",{className:"modal-body",children:Object.keys(i).length&&e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Họ và tên"}),e.jsx("input",{type:"text",className:"form-control",value:i.customer.user.fullName,readOnly:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Số điện thoại"}),e.jsx("input",{type:"text",className:"form-control",value:i.customer.user.phoneNumber,readOnly:!0})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Ngày khám"}),e.jsx("input",{type:"date",className:"form-control",name:"dateBooking",defaultValue:i.dateBooking,min:r,onChange:N})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Dịch vụ"}),e.jsxs("select",{name:"eyeCategory",id:"categorySelect",className:"form-control",onChange:Q,children:[e.jsx("option",{value:i.eyeCategory.id,children:i.eyeCategory.nameCategory}),O.map(t=>{if(t.nameCategory!=i.eyeCategory.nameCategory)return e.jsx("option",{value:t.id,children:t.nameCategory},t.id)})]})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Giờ khám"}),e.jsx("select",{className:"form-control",name:"timeBooking",id:"",onChange:N,children:$.map((t,n)=>e.jsx("option",{value:t,selected:t==i.timeBooking,children:t},n))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{children:"Lý do thay đổi"}),e.jsx("input",{type:"text",className:"form-control",name:"message",onChange:N})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-dismiss":"modal",onClick:A,children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal",onClick:_,children:"Save changes"})]})]})})})]})}export{ke as default};
